<%- include('../partials/head') %>
<style>
    
    .card-body .bold-text {
        font-weight: bold;
    }

</style>

<body>
    <%- include('../partials/header') %>

    <div class="offcanvas-overlay"></div>

    <!-- Breadcrumb Section -->
    <div class="breadcrumb-section breadcrumb-bg-color--golden">
        <div class="breadcrumb-wrapper">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <h3 class="breadcrumb-title">User Address</h3>
                        <div class="breadcrumb-nav breadcrumb-nav-color--black breadcrumb-nav-hover-color--golden">
                            <nav aria-label="breadcrumb">
                                <ul>
                                    <li><a href="/">Home</a></li>
                                    <li><a href="/products">Shop</a></li>
                                    <li class="active" aria-current="page">User Address</li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Address Management Section -->
    <div class="container my-5">
        <div class="row mb-4">
            <div class="col-12 d-flex justify-content-between align-items-center">
                <h4 class="mb-0">Saved Addresses</h4>
                <a href="/userAddAddress" class="btn btn-primary">Add New Address</a>
            </div>
        </div>
        
        <% for (let i = 0; i < address.length; i++) { %>
            <% if (i % 2 === 0) { %> <!-- Start a new row for every second address -->
                <div class="row">
            <% } %>
            
            <div class="col-md-6">
                <!-- Repeat the below div for each address -->
                <div class="card mb-3" style="width: 100%;">
                    <div class="card-body">
                        <div class="radio-container mb-3">
                            <!-- <input type="radio" class="form-check-input" onclick="selectAddress('<%#= address[i]._id %>')" name="addressSelection" data-id="<%#= address._id %>"> -->
                            <!-- <label class="form-check-label ms-2" style="font-weight: 800; font-size: larger;">Select</label> -->
                        </div>
    
                        <h5 class="card-subtitle mb-2 text-muted bold-text">Name: <%= address[i].name %></h5>
                        <h5 class="card-text bold-text">Address: <%= address[i].address %></h5>  
                        <p class="card-text bold-text">Street: <%= address[i].street %></p>
                        <p class="card-text bold-text">City: <%= address[i].city %></p>
                        <p class="card-text bold-text">State: <%= address[i].state %></p>
                        <p class="card-text bold-text">Pincode: <%= address[i].pincode %></p>
                        <p class="card-text bold-text">Phone: <%= address[i].phone %></p>
                        <div class="d-flex justify-content-between">
                            <a class="btn btn-warning" href="/editAddress/?addressId=<%= address[i]._id %>&path=userAddress">Edit</a>
                            <button class="btn btn-danger text-light" onclick="delAddress('<%= address[i]._id %>')">Delete</button>
                        </div>
                    </div>
                </div>
                <!-- End of address card -->
            </div>
            
            <% if (i % 2 !== 0 || i === address.length - 1) { %> <!-- Close row if it's the second address or the last address -->
                </div>
            <% } %>
        <% } %>
        
    </div>

    <%- include('../partials/footer') %>

    <script>
        setTimeout(function() {
            const errMsg = document.querySelectorAll('.error-message');
            errMsg.forEach(function(message) {
                message.innerHTML = '';
            });
        }, 4000);
    </script>
    <script>
         function delAddress(id) {
            fetch(`/deleteAddress?id=${id}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.result === 'success') {
                        Swal.fire("Address deleted successfully").then(() => {
                            location.reload()
                        })
                        // Optionally refresh the page or update the address list dynamically
                    }
                })
                .catch(error => {
                    console.error('There was a problem with the fetch operation:', error);
                });
            // Your delAddress logic here
            console.log("Address deleted:", id);
        }
    </script>
</body>

</html>
